pipeline {
    agent any
    stages {
        stage('Build') {
            steps {
                echo 'Starting Build'
                script{
                    try{
                        echo 'scriptint is running'
                        python3 -m pip install --user virtualenv
                        python3 -m virtualenv nims_all_numbers
                        source nims_all_numbers/bin/activate
                        which python
                        pwd
                        python --version
                        python3 --version
                        which python
                        echo 'script about to run!!!!'
                        python3 app.py	
                        echo 'script no error'
                        python3 --version
                        which python 
                        deactivate 
                        rm -rf nims_all_numbers				
                        echo 'script running done'
                    }
                    catch (err){
                        echo 'Error catched'
                        currentBuild.result = 'FAILURE'
                        echo 'Error catched'
                        deactivate 
                        rm -rf nims_all_numbers
                        throw err
                    }
                }
            }
        }
    }
    post{
        failure {
            echo 'Build failed!!!!'
        }
    }
}

